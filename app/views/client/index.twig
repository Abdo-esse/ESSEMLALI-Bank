{% extends "components/baseDashbord.twig" %}

{% block title %}Page d'accueil{% endblock %}
{% block sidebar %}
    {% include "layout/sidebarClient.twig" %}
{% endblock %}


{% block content %}


    <div class="bg-gray-100 font-sans">
        <div class="container mx-auto px-4 py-8">
            <!-- Header Section with Client Info -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h1 class="text-2xl font-bold text-indigo-800">
                            Bonjour, {{ client.client.prenom }} {{ client.client.nom }}</h1>
                        <p class="text-gray-600">Bienvenue dans votre espace bancaire</p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-gray-500">Date: {{ "now"|date("d M Y - H:i") }}</p>
                    </div>
                </div>

                <div class="flex flex-col md:flex-row gap-4">
                    <div class="bg-indigo-50 rounded-lg p-4 flex-1">
                        <p class="text-sm font-medium text-indigo-600 mb-1">IBAN</p>
                        <p class="text-lg font-medium">{{ client.compte.numerocompte }}</p>
                    </div>
                    <div class="bg-indigo-600 text-white rounded-lg p-4 flex-1" x-data="{ showBalance: false }">
                        <div class="flex justify-between items-center">
                            <p class="text-lg font-medium">Solde disponible</p>
                            <button @click="showBalance = !showBalance" class="focus:outline-none">
                                <i class="fas" :class="showBalance ? 'fa-eye-slash' : 'fa-eye'"></i>
                            </button>
                        </div>
                        <p x-show="showBalance" class="text-2xl font-bold mt-2 ">{{ client.compte.solde }} MAD</p>
                        <p x-show="!showBalance" class="text-2xl font-bold mt-2">••••••• MAD</p>
                    </div>
                </div>
            </div>

            <!-- Cards for Actions -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <!-- Transaction Card -->
                <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition duration-300">
                    <div class="flex justify-center items-center w-12 h-12 bg-green-100 rounded-full mb-4">
                        <i class="fas fa-exchange-alt text-green-600 text-xl"></i>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-800 mb-2">Effectuer une transaction</h2>
                    <p class="text-gray-600 mb-4">Virements nationaux et internationaux vers vos bénéficiaires</p>
                    <button class="w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 transition duration-300">
                        Nouvelle transaction
                    </button>
                </div>

                <!-- Account Statement Card -->
                <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition duration-300">
                    <div class="flex justify-center items-center w-12 h-12 bg-blue-100 rounded-full mb-4">
                        <i class="fas fa-file-invoice text-blue-600 text-xl"></i>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-800 mb-2">Relevé de compte</h2>
                    <p class="text-gray-600 mb-4">Téléchargez vos relevés mensuels et documents bancaires</p>
                    <button class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300">
                        Voir mes relevés
                    </button>
                </div>

                <!-- History Card -->
                <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition duration-300">
                    <div class="flex justify-center items-center w-12 h-12 bg-purple-100 rounded-full mb-4">
                        <i class="fas fa-history text-purple-600 text-xl"></i>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-800 mb-2">Historique des opérations</h2>
                    <p class="text-gray-600 mb-4">Consultez l'ensemble de vos mouvements financiers</p>
                    <button class="w-full bg-purple-600 text-white py-2 px-4 rounded-md hover:bg-purple-700 transition duration-300">
                        Voir l'historique
                    </button>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold text-gray-800">Dernières transactions</h2>
                    <a href="historique" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">Voir tout</a>
                </div>

                <div class="divide-y divide-gray-200">
                    {% for historique in historiques|slice(0, 4) %}
                        {# Vérification de l'existence des relations et propriétés #}
                        {% if historique.typeOperation == "Deposit" %}
                            <div class="py-4 flex justify-between items-center">
                                <div>
                                    <p class="font-medium text-gray-800">Dépôt</p>
                                    <p class="text-sm text-gray-500">
                                        {{ historique.dateEffectue|date('d/m/Y H:i') }} -
                                        {{ historique.donneur.nom|trim }}
                                    </p>
                                </div>
                                <span class="font-semibold text-green-600">+{{ historique.montant|number_format(2, ',', ' ') }} MAD</span>
                            </div>

                        {% elseif historique.typeOperation == "Retrait" %}
                            <div class="py-4 flex justify-between items-center">
                                <div>
                                    <p class="font-medium text-gray-800">Retrait</p>
                                    <p class="text-sm text-gray-500">{{ historique.dateEffectue|date('d/m/Y H:i') }}</p>
                                </div>
                                <span class="font-semibold text-red-600">-{{ historique.montant|number_format(2, ',', ' ') }} MAD</span>
                            </div>

                        {% elseif historique.typeOperation == "virement" %}
                            {# Vérification que le bénéficiaire existe avant d'accéder à ses propriétés #}
                            {% if historique.donneur.id == session.user.id and historique.beneficiaire is not null %}
                                <div class="py-4 flex justify-between items-center">
                                    <div>
                                        <p class="font-medium text-gray-800">
                                            Vous avez effectué un virement
                                            à {{ historique.beneficiaire.nom|trim }} {{ historique.beneficiaire.prenom|trim }}
                                        </p>
                                        <p class="text-sm text-gray-500">{{ historique.dateEffectue|date('d/m/Y H:i') }}</p>
                                        <p class="text-sm text-gray-500">{{ historique.description }}</p>
                                    </div>
                                    <span class="font-semibold text-red-600">-{{ historique.montant|number_format(2, ',', ' ') }} MAD</span>
                                </div>

                            {% elseif historique.beneficiaire is not null and historique.beneficiaire.id == session.user.id %}
                                <div class="py-4 flex justify-between items-center">
                                    <div>
                                        <p class="font-medium text-gray-800">
                                            Vous avez reçu un virement
                                            de {{ historique.donneur.nom|trim }} {{ historique.donneur.prenom|trim }}
                                        </p>
                                        <p class="text-sm text-gray-500">{{ historique.dateEffectue|date('d/m/Y H:i') }}</p>
                                        <p class="text-sm text-gray-500">{{ historique.description }}</p>
                                    </div>
                                    <span class="font-semibold text-green-600">+{{ historique.montant|number_format(2, ',', ' ') }} MAD</span>
                                </div>
                            {% endif %}
                        {% endif %}
                    {% else %}
                        <p class="p-4 text-gray-500">Aucune opération à afficher</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}