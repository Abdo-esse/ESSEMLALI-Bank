{% extends "components/baseDashbord.twig" %}

{% block title %}Page d'accueil{% endblock %}
{% block sidebar %}
{% include "layout/sidebarEmploye.twig" %}
{% endblock %}


{% block content %}


<div class="relative overflow-x-auto shadow-md sm:rounded-lg">
    <div class="flex flex-col md:flex-row items-center justify-between p-4 bg-white dark:bg-gray-900">
        <!-- Titre et bouton d'ajout -->
        <div class="flex items-center mb-4 md:mb-0">
            <h2 class="text-xl font-semibold text-gray-800 dark:text-white">Gestion des demande comptes</h2>
            <button data-modal-target="client-modal" data-modal-toggle="client-modal" class=" ml-4 inline-flex items-center text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800" type="button">
                <svg class="w-4 h-4 mr-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                Ajouter un Client
            </button>
        </div>

<!-- Main modal -->

{% if session.errorClient  %}
<div id="client-modal" tabindex="-1" aria-hidden="true" class="  overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 flex justify-center items-center w-full md:inset-0 h-screen max-h-full backdrop-blur-sm bg-gray-900/50">
{% else %}
<div id="client-modal" tabindex="-1" aria-hidden="true" class=" hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 flex justify-center items-center w-full md:inset-0 h-screen max-h-full backdrop-blur-sm bg-gray-900/50">
{% endif %}


    <div class="relative p-4 w-full max-w-md max-h-full">
        <!-- Modal content -->
        <div class="relative bg-white rounded-lg shadow-xl dark:bg-gray-700">
            <!-- Modal header -->
            <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600 border-gray-200">
                <div class="text-xl font-bold flex justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 150" class="w-40 h-auto">
                        <!-- Fond du logo -->
                        <rect width="300" height="150" rx="20" fill="#ffffff"/>

                        <!-- Symbole bancaire stylisé -->
                        <g transform="translate(65, 30)">
                            <!-- Piliers bancaires stylisés -->
                            <rect x="0" y="30" width="20" height="60" rx="2" fill="#1d4ed8"/>
                            <rect x="30" y="20" width="20" height="70" rx="2" fill="#1d4ed8"/>
                            <rect x="60" y="10" width="20" height="80" rx="2" fill="#1d4ed8"/>
                            <rect x="90" y="0" width="20" height="90" rx="2" fill="#1d4ed8"/>

                            <!-- Toit bancaire arrondi -->
                            <path d="M0,30 Q55,-10 110,0 L110,10 L0,10 Z" fill="#1d4ed8"/>

                            <!-- Pièce/Monnaie symbolisant la finance -->
                            <circle cx="140" cy="35" r="30" fill="#f59e0b"/>
                            <circle cx="140" cy="35" r="25" fill="#fbbf24"/>
                            <text x="140" y="42" font-family="Arial" font-size="24" font-weight="bold" text-anchor="middle" fill="#ffffff">€</text>
                        </g>

                        <!-- Nom de la banque -->
                        <text x="150" y="140" font-family="Arial" font-size="22" font-weight="bold" text-anchor="middle" fill="#1d4ed8">EssemlaliBank</text>
                    </svg>
                </div>
                <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="client-modal">
                    <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>

            <!-- Modal body -->
            <div class="p-4 md:p-5">
                <h2 class="text-2xl font-bold text-center text-blue-700 mb-6 dark:text-blue-400">Ajout d'un Client</h2>

                        <form class="space-y-6" action="addClient" method="POST" enctype="multipart/form-data" >
                            <!-- Nom et Prénom -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                <label for="nom" class="block text-sm font-medium text-gray-700 mb-1">Nom</label>
                                <input type="text" id="nom" name="nom" required value="{{session.valuesClient.nom}}"
                                        class="w-full px-4 py-2 border {% if session.errorClient.nom is defined %}border-red-500{% else %}border-gray-300{% endif %} rounded-md focus:outline-none focus:ring-2 focus:ring-blue-700 focus:border-transparent">
                                {% if session.errorClient.nom is defined %}
                                    <p class="mt-1 text-sm text-red-600">
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                        </svg>
                                        {{ session.errorClient.nom }}
                                    </span>
                                    </p>
                                {% endif %}
                                </div>
                                <div>
                                <label for="prenom" class="block text-sm font-medium text-gray-700 mb-1">Prénom</label>
                                <input type="text" id="prenom" name="prenom" required value="{{session.valuesClient.prenom}}"
                                        class="w-full px-4 py-2 border {% if session.errorClient.prenom is defined %}border-red-500{% else %}border-gray-300{% endif %} rounded-md focus:outline-none focus:ring-2 focus:ring-blue-700 focus:border-transparent">
                                {% if session.errorClient.prenom is defined %}
                                    <p class="mt-1 text-sm text-red-600">
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                        </svg>
                                        {{ session.errorClient.prenom }}
                                    </span>
                                    </p>
                                {% endif %}
                                </div>
                            </div>

                            <!-- Email -->
                            <div>
                                <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Adresse e-mail</label>
                                <input type="email" id="email" name="email" required value="{{session.valuesClient.email}}"
                                    class="w-full px-4 py-2 border {% if session.errorClient.email is defined %}border-red-500{% else %}border-gray-300{% endif %} rounded-md focus:outline-none focus:ring-2 focus:ring-blue-700 focus:border-transparent">
                                {% if session.errorClient.email is defined %}
                                <p class="mt-1 text-sm text-red-600">
                                    <span class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                    {{ session.errorClient.email }}
                                    </span>
                                </p>
                                {% endif %}
                            </div>

                            <!-- Sexe et Téléphone -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Sexe</label>
                                <div class="flex space-x-4 mt-2">
                                    <div class="flex items-center">
                                    <input type="radio" id="homme" name="sexe" value="homme" required
                                            class="h-4 w-4 text-blue-700 focus:ring-blue-700 border-gray-300"
                                            {% if session.valuesClient.sexe == 'homme' %}checked{% endif %}>
                                    <label for="homme" class="ml-2 block text-sm text-gray-700">Homme</label>
                                    </div>
                                    <div class="flex items-center">
                                    <input type="radio" id="femme" name="sexe" value="femme" required
                                            class="h-4 w-4 text-blue-700 focus:ring-blue-700 border-gray-300"
                                            {% if session.valuesClient.sexe == 'femme' %}checked{% endif %}>
                                    <label for="femme" class="ml-2 block text-sm text-gray-700">Femme</label>
                                    </div>
                                </div>
                                {% if session.errorClient.sexe is defined %}
                                    <p class="mt-1 text-sm text-red-600">
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                        </svg>
                                        {{ session.errorClient.sexe }}
                                    </span>
                                    </p>
                                {% endif %}
                                </div>
                                <div>
                                <label for="telephone" class="block text-sm font-medium text-gray-700 mb-1">Téléphone</label>
                                <input type="tel" id="telephone" name="telephone" required value="{{session.valuesClient.telephone}}"
                                        class="w-full px-4 py-2 border {% if session.errorClient.telephone is defined %}border-red-500{% else %}border-gray-300{% endif %} rounded-md focus:outline-none focus:ring-2 focus:ring-blue-700 focus:border-transparent">
                                {% if session.errorClient.telephone is defined %}
                                    <p class="mt-1 text-sm text-red-600">
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                        </svg>
                                        {{ session.errorClient.telephone }}
                                    </span>
                                    </p>
                                {% endif %}
                                </div>
                            </div>

                            <!-- Adresse -->
                            <div>
                                <label for="adresse" class="block text-sm font-medium text-gray-700 mb-1">Adresse complète</label>
                                <textarea id="adresse" name="adresse" rows="3" required
                                        class="w-full px-4 py-2 border {% if session.errorClient.adresse is defined %}border-red-500{% else %}border-gray-300{% endif %} rounded-md focus:outline-none focus:ring-2 focus:ring-blue-700 focus:border-transparent">{{session.valuesClient.adresse}}</textarea>
                                {% if session.errorClient.adresse is defined %}
                                <p class="mt-1 text-sm text-red-600">
                                    <span class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                    {{ session.errorClient.adresse }}
                                    </span>
                                </p>
                                {% endif %}
                            </div>

                            <!-- Photo de carte d'identité -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Photo de carte d'identité</label>
                                <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 {% if session.errorClient.carte_identite is defined %}border-red-500{% else %}border-gray-300{% endif %} border-dashed rounded-md">
                                <div class="space-y-1 text-center">
                                    <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4h-12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    <div class="flex text-sm text-gray-600">
                                    <label for="carte-identite" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-700 hover:text-blue-800 focus-within:outline-none">
                                        <span>Télécharger un fichier</span>
                                        <input id="carte-identite" name="carte_identite" type="file" accept="image/*" onchange="previewImage(event)" class="sr-only" required>
                                    </label>
                                    <p class="pl-1">ou glisser-déposer</p>
                                    </div>
                                    <p class="text-xs text-gray-500">
                                    PNG, JPG, PDF jusqu'à 10MB
                                    </p>
                                </div>
                                </div>
                                {% if session.errorClient.carte_identite is defined %}
                                <p class="mt-1 text-sm text-red-600">
                                    <span class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                    {{ session.errorClient.carte_identite }}
                                    </span>
                                </p>
                                {% endif %}
                            </div>

                                <!-- Upload de la carte d'identité -->
                                <div>
                                <!-- Affichage de l'aperçu de l'image -->
                                {% if session.valuesClient.carte_identite is defined %}
                                    <img id="image-preview" src="../../../public/uploads/{{ session.valuesClient.carte_identite }}" alt="Aperçu de l'image"
                                        class="mt-3 mx-auto h-20 w-20 object-cover border rounded-lg">
                                {% else %}
                                    <img id="image-preview" src="" alt="Aperçu de l'image"
                                        class="hidden mt-3 mx-auto h-20 w-20 object-cover border rounded-lg">
                                {% endif %}
                                </div>

                            <!-- Conditions d'utilisation -->
                            <div class="flex items-start">
                                <div class="flex items-center h-5">
                                <input id="conditions" name="conditions" type="checkbox" required  {% if session.valuesClient.conditions == 'on' %}checked{% endif %}
                                        class="h-4 w-4 text-blue-700 focus:ring-blue-700 {% if session.errorClient.conditions is defined %}border-red-500{% else %}border-gray-300{% endif %} rounded">
                                </div>
                                <div class="ml-3 text-sm">
                                <label for="conditions" class="font-medium text-gray-700">J'accepte les conditions d'utilisation</label>
                                <p class="text-gray-500">En soumettant ce formulaire, j'accepte que mes données soient traitées conformément à la politique de confidentialité d'EssemlaliBank.</p>
                                </div>
                            </div>
                            {% if session.errorClient.conditions is defined %}
                                <p class="mt-1 text-sm text-red-600">
                                <span class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                    {{ session.errorClient.conditions }}
                                </span>
                                </p>
                            {% endif %}

                            <!-- Bouton de soumission -->
                            <div>
                                <button type="submit"
                                        class="w-full bg-blue-700 text-white py-3 px-4 rounded-md font-medium hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150">
                                Soumettre ma demande
                                </button>
                            </div>
                        </form>
            </div>

            <!-- Modal footer -->
            <div class="flex items-center justify-end p-4 md:p-5 border-t border-gray-200 rounded-b dark:border-gray-600">
                <button data-modal-hide="client-modal" type="button" class="py-2.5 px-5 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-gray-100 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700">
                    Annuler
                </button>
            </div>
        </div>
    </div>
</div>
        
        <!-- Recherche -->
        <div class="relative w-full md:w-auto">
            <div class="absolute inset-y-0 rtl:inset-r-0 start-0 flex items-center ps-3 pointer-events-none">
                <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
                </svg>
            </div>
            <input type="text" id="table-search" class="block w-full p-2 ps-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Rechercher un administrateur...">
        </div>
    </div>
    
    <div class="overflow-x-auto">
    <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
        <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
            <tr>
                <th scope="col" class="px-6 py-3">
                    prenom
                </th>
                <th scope="col" class="px-6 py-3">
                    nom
                </th>
                <th scope="col" class="px-6 py-3">
                    Email
                </th>
                <th scope="col" class="px-6 py-3">
                    Date de création
                </th>
                <th scope="col" class="px-6 py-3">
                    Statut
                </th>
                <th scope="col" class="px-6 py-3">
                    Actions
                </th>
            </tr>
        </thead>
        <tbody>
        {% for client in clients %}
            <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap ">
                    {{ client.nom }}
                </td>
                <td class="px-6 py-4">
                     {{client.prenom }}
                </td>
                <td class="px-6 py-4">
                    {{client.email }}
                </td>
                <td class="px-6 py-4">
                 {{client.dateCreation|date('Y-m-d')}} 
                </td>
                <td class="px-6 py-4">
                    {% if client.isActive  %}
                    <span class="px-2 py-1 text-xs font-medium text-green-700 bg-green-100 rounded-full dark:bg-green-900 dark:text-green-300">Actif</span>
                        {% else %}
                            <span class="px-2 py-1 text-xs font-medium text-gray-700 bg-gray-100 rounded-full dark:bg-gray-700 dark:text-gray-300">Inactif</span>
                    {% endif %}
                </td>
                <td class="px-6 py-4">
                    <div class="flex space-x-2">
                        <a href="voir/{{ client.id }}" class="font-medium text-blue-600 dark:text-blue-500 hover:underline">
                            <button type="button" class="px-3 py-1.5 text-xs font-medium text-center text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                                Voir
                            </button>
                        </a>                    
                        
                    </div>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>



<script src="{{ asset('js/demandeClients.js') }}"></script>
{% endblock %}